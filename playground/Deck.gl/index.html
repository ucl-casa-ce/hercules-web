<!doctype html>
<!--
 @license
 Copyright 2019 Google LLC. All Rights Reserved.
 SPDX-License-Identifier: Apache-2.0
-->
<html>

<head>
    <title>deck.gl Trips Layer</title>
    <script src="https://unpkg.com/@deck.gl/layers@^8.9.22/dist.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script src="https://unpkg.com/deck.gl@8.9.22/dist.min.js"></script>
    <script src="https://unpkg.com/@deck.gl/google-maps@8.9.22/dist.min.js"></script>

    <script src="https://unpkg.com/@deck.gl/core@^8.9.22/dist.min.js"></script>
    <script src="https://unpkg.com/@deck.gl/layers@^8.9.22/dist.min.js"></script>
    <script>

        /**
         * @license
         * Copyright 2021 Google LLC.
         * SPDX-License-Identifier: Apache-2.0
         */
        // TODO Use imports when Deck.gl works in more bundlers
        // https://github.com/visgl/deck.gl/issues/6351#issuecomment-1079424167
        // import { GoogleMapsOverlay } from "https://cdn.skypack.dev/@deck.gl/google-maps";
        // import { TripsLayer } from "https://cdn.skypack.dev/deck.gl";
        const GoogleMapsOverlay = deck.GoogleMapsOverlay;
        const TripsLayer = deck.TripsLayer;
        const DATA_URL =
            "trips-v7.json";
        const LOOP_LENGTH = 600;
        const VENDOR_COLORS = [
            [255, 0, 0],
            [0, 0, 255], // vendor #1
        ];

        function initMap() {
            const layer = new deck.BitmapLayer({
                id: 'bitmap-layer',
                //[[40.685544, -74.024034], [40.734470, -74.034341], [40.740193, -73.938146], [40.679816, -73.942956]]
                bounds: [-74.024034, 40.685544, -73.938146, 40.740193],
                image: 'p2.png'
            });

            const map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 40.72, lng: -74 },
                mapId: "fae05836df2dc8bb",
                tilt: 0,
                zoom: 15,
            });
            let currentTime = 0;
            const props = {
                id: "trips",
                data: DATA_URL,
                getPath: (d) => d.path,
                getTimestamps: (d) => d.timestamps,
                getColor: (d) => VENDOR_COLORS[d.vendor],
                opacity: 1,
                widthMinPixels: 2,
                trailLength: 180,
                currentTime,
                shadowEnabled: false,
            };
            const overlay = new GoogleMapsOverlay({});

            const animate = () => {
                currentTime = (currentTime + 1) % LOOP_LENGTH;

                const tripsLayer = new TripsLayer({
                    ...props,
                    currentTime,
                });

                overlay.setProps({
                    layers: [layer, tripsLayer],
                });
                window.requestAnimationFrame(animate);
            };

            window.requestAnimationFrame(animate);
            overlay.setMap(map);
        }

        window.initMap = initMap;

    </script>
    <style>
        /**
 * @license
 * Copyright 2021 Google LLC.
 * SPDX-License-Identifier: Apache-2.0
 */
        :root {
            --mdc-theme-primary: #1a73e8;
            --mdc-theme-secondary: #rgb(225, 245, 254);
            --mdc-theme-on-primary: #fff;
            --mdc-theme-on-secondary: rgb(1, 87, 155);
        }

        .mdc-text-field--focused:not(.mdc-text-field--disabled) .mdc-floating-label {
            color: var(--mdc-theme-primary);
        }

        /* 
 * Always set the map height explicitly to define the size of the div element
 * that contains the map. 
 */
        #map {
            height: 100%;
        }

        /* 
 * Optional: Makes the sample page fill the window. 
 */
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
    <!-- jsFiddle will insert css and js -->
</head>

<body>
    <div id="map"></div>

    <!-- 
      The `defer` attribute causes the callback to execute after the full HTML
      document has been parsed. For non-blocking uses, avoiding race conditions,
      and consistent behavior across browsers, consider loading using Promises.
      See https://developers.google.com/maps/documentation/javascript/load-maps-js-api
      for more information.
      -->
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBDGRnJKBnJK0_dtHIeurH6NgEq8J3VJh8&callback=initMap&v=weekly"
        defer></script>
</body>

</html>